(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{22:function(e,t,a){e.exports=a(57)},31:function(e,t,a){},35:function(e,t,a){},37:function(e,t,a){},43:function(e,t,a){},45:function(e,t,a){},53:function(e,t,a){},55:function(e,t,a){},57:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(20),s=a.n(i),o=a(60),c=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function l(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}var u,v,m,p,f=a(14),h=Object(f.a)({basename:"/mymovies/"}),d=(a(31),a(2)),g=a(3),_=a(5),b=a(4),y=a(6),E=a(61),w=a(58),j=Object(n.createContext)(),M=j.Provider,k=j.Consumer,O=function(e){return function(t){function a(){return Object(d.a)(this,a),Object(_.a)(this,Object(b.a)(a).apply(this,arguments))}return Object(y.a)(a,t),Object(g.a)(a,[{key:"render",value:function(){var t=this;return r.a.createElement(k,null,function(a){return r.a.createElement(e,Object.assign({},a,t.props))})}}]),a}(n.Component)},S=Object.freeze({main:"/",favorites:"/favorites",search:"/search",film:"/movie"}),N=a(7),x=a.n(N),I=a(10),F="https://api.themoviedb.org/3/",A="e8b2b9d1a810a529d76a8fb24caa84df",P=function(e){return"".concat(F,"movie/").concat(e,"?api_key=").concat(A,"&language=en-US")},C=function(e){return"".concat(F,"movie/popular?api_key=").concat(A,"&language=en-US&page=").concat(e)},D=function(e,t){return"".concat(F,"search/movie?api_key=").concat(A,"&language=en-US&query=").concat(e,"&page=").concat(t,"&include_adult=false")},R={fetchPopularMovies:(p=Object(I.a)(x.a.mark(function e(t){var a,n,r,i;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(C(t));case 2:if(200===(a=e.sent).status){e.next=5;break}throw new Error("Popular movies were not fetched.");case 5:return e.next=7,a.json();case 7:return n=e.sent,r=n.results,i=n.total_pages,e.abrupt("return",{popularMovies:r,totalPages:i});case 11:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)}),searchMovies:(m=Object(I.a)(x.a.mark(function e(t,a){var n,r,i,s,o;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.toLowerCase().replace(/ /g,"%20"),e.next=3,fetch(D(n,a));case 3:if(200===(r=e.sent).status){e.next=6;break}throw new Error("Search movies were not fetched.");case 6:return e.next=8,r.json();case 8:return i=e.sent,s=i.results,o=i.total_pages,e.abrupt("return",{foundMovies:s,totalPages:o});case 12:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)}),fetchFavoriteMovies:(v=Object(I.a)(x.a.mark(function e(t){var a,n,r,i,s,o,c,l,u,v,m;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(a=[],n=!0,r=!1,i=void 0,e.prev=4,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0)c=o.value,a.push(fetch((p=c,"".concat(F,"movie/").concat(p,"?api_key=").concat(A,"&language=en-US"))));e.next=12;break;case 8:e.prev=8,e.t0=e.catch(4),r=!0,i=e.t0;case 12:e.prev=12,e.prev=13,n||null==s.return||s.return();case 15:if(e.prev=15,!r){e.next=18;break}throw i;case 18:return e.finish(15);case 19:return e.finish(12);case 20:return e.next=22,Promise.all(a);case 22:return l=e.sent,u=l.every(function(e){return 200===e.status}),v=l.map(function(e){return e.json()}),e.next=27,Promise.all(v);case 27:if(m=e.sent,u){e.next=30;break}throw new Error("Favorite movies were not fetched");case 30:return e.abrupt("return",m);case 31:case"end":return e.stop()}var p},e,this,[[4,8,12,20],[13,,15,19]])})),function(e){return v.apply(this,arguments)}),fetchMovie:(u=Object(I.a)(x.a.mark(function e(t){var a,n;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(P(t));case 2:if(200===(a=e.sent).status){e.next=5;break}throw new Error("Movie data is not fetched.");case 5:return e.next=7,a.json();case 7:return n=e.sent,e.abrupt("return",n);case 9:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},q=function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:window;return function(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];var c=n&&!t;clearTimeout(t),t=setTimeout(function(){t=null,n||e.apply(r,s)},a),c&&e.apply(r,s)}},Q=(a(35),function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(_.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(r)))).state={query:""},a._handleFormSubmit=function(e){e.preventDefault(),a._submitQuery()},a._updateQuery=function(e){var t=e.target.value;a.setState({query:t})},a._submitQuery=function(){var e=a.state.query;if(!e)return null;h.push({pathname:"/search",search:"results=".concat(e)}),a.setState({query:""})},a._handleKeyDown=function(e){"Enter"===e.key&&(e.preventDefault(),a._submitQuery())},a}return Object(y.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"search"},r.a.createElement("form",{className:"search-form",onSubmit:this._handleFormSubmit},r.a.createElement("input",{className:"search-form__input",type:"text",placeholder:"Find movies",onChange:this._updateQuery,onKeyDown:this._handleKeyDown}),r.a.createElement("button",{type:"submit",className:"btn search-form__btn"})))}}]),t}(n.Component)),L=a(59),U=(a(37),function(e){function t(){return Object(d.a)(this,t),Object(_.a)(this,Object(b.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return r.a.createElement("header",{className:"header"},r.a.createElement("div",{className:"header__wrapper container"},r.a.createElement("div",{className:"logo"},r.a.createElement(L.a,{to:"/",className:"logo__link"},"MyMovies")),r.a.createElement("div",{className:"header__links header-links"},r.a.createElement(L.a,{to:"/favorites",className:"header-links__item header-links__item_fav"}))))}}]),t}(n.Component)),W=a(42),T=(a(43),function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(_.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(r)))).state={like:a.props.favoriteMoviesIds.includes(a.props.id.toString())},a._toggleLike=function(){var e=a.state.like,t=a.props.id.toString(),n=a.props.fetchFavoriteMoviesAsync;e?(a._deleteMovieId(t),a.setState({like:!1})):(a._setMovieId(t),a.setState({like:!0})),n&&n()},a._setMovieId=function(e){var t=a.props.favoriteMoviesIds;t.push(e),localStorage.setItem("favMovies",t)},a._deleteMovieId=function(e){var t=a.props.favoriteMoviesIds;t.splice(t.indexOf(e),1),localStorage.setItem("favMovies",t)},a}return Object(y.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this.props,t=e.id,a=e.poster_path,n=e.original_title,i=e.release_date,s=e.vote_average,o=this.state.like,c=r.a.createElement("img",{className:"movie__poster",src:"https://image.tmdb.org/t/p/w300/".concat(a),alt:"".concat(n," poster")}),l=r.a.createElement("div",{className:"movie__no-poster"});return r.a.createElement("div",{className:"movie"},r.a.createElement("div",{className:"movie__container"},a?c:l,r.a.createElement("div",{className:"movie__info"},r.a.createElement(W.a,{className:"movie__link",to:{pathname:"/movie",search:"?id=".concat(t)}},r.a.createElement("h2",{className:"movie__title"},n)),r.a.createElement("div",{className:"movie__block"},r.a.createElement("div",{className:"movie__wrap"},r.a.createElement("span",{className:"movie__rate"},"Rate: ".concat(s)),r.a.createElement("span",{className:"movie__date"},"Date: ".concat(i))),r.a.createElement("button",{className:o?"movie__like movie__like_active":"movie__like",onClick:this._toggleLike})))))}}]),t}(n.Component)),H=(a(45),function(e){function t(){return Object(d.a)(this,t),Object(_.a)(this,Object(b.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return this.props.isSpinning?r.a.createElement("div",{className:"spinner"},r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null),r.a.createElement("div",null)):null}}]),t}(n.Component)),K=O(function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(_.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(r)))).state={popularMovies:[],isSpinning:!1},a.page={pages:1,totalPages:1},a._initInfiniteScroll=q(function(){window.innerHeight+window.scrollY>=document.body.offsetHeight&&a.page.pages<a.page.totalPages&&(a.page.pages+=1,a._fetchPopularMoviesAsync(a.page.pages))}),a._setMoviesFetchingState=function(e){a.setState({isSpinning:e})},a._fetchPopularMoviesAsync=function(){var e=Object(I.a)(x.a.mark(function e(t){var n,r,i,s;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a._setMoviesFetchingState(!0),e.next=4,R.fetchPopularMovies(t);case 4:n=e.sent,r=n.popularMovies,i=n.totalPages,a.page.totalPages!==i&&(a.page.totalPages=i),a.setState({popularMovies:a.state.popularMovies.concat(r)}),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),s=e.t0.message,console.log(s);case 16:return e.prev=16,a._setMoviesFetchingState(!1),e.finish(16);case 19:case"end":return e.stop()}},e,this,[[0,12,16,19]])}));return function(t){return e.apply(this,arguments)}}(),a}return Object(y.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){var e=this.page.pages;this._fetchPopularMoviesAsync(e),window.addEventListener("scroll",this._initInfiniteScroll)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this._initInfiniteScroll)}},{key:"render",value:function(){var e=this.state,t=e.popularMovies,a=e.isSpinning,i=this.props.favoriteMoviesIds,s=t.map(function(e){return r.a.createElement(T,Object.assign({favoriteMoviesIds:i,key:e.id},e))});return r.a.createElement(n.Fragment,null,r.a.createElement(U,null),r.a.createElement("main",{id:"main",className:"main"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"heading"},r.a.createElement("h1",{className:"heading__title"},"Discover, find and save movies to your collection of favorites")),r.a.createElement(Q,null),r.a.createElement("div",{id:"movies-list",className:"movie-list"},s),r.a.createElement(H,{isSpinning:a}))))}}]),t}(n.Component)),B=a(12),J=a.n(B),Y=(a(53),O(function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(_.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(r)))).state={movieData:{}},a._fetchMovieAsync=function(){var e=Object(I.a)(x.a.mark(function e(t){var n,r;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,R.fetchMovie(t);case 3:n=e.sent,a.setState({movieData:n}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),r=e.t0.message,console.log(r);case 11:return e.prev=11,e.finish(11);case 13:case"end":return e.stop()}},e,this,[[0,7,11,13]])}));return function(t){return e.apply(this,arguments)}}(),a}return Object(y.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){var e=J.a.parse(this.props.location.search).id;this._fetchMovieAsync(e)}},{key:"render",value:function(){var e=this.state.movieData,t=e.poster_path,a=e.original_title,i=e.tagline,s=e.overview,o=e.vote_average,c=e.genres,l=e.release_date,u=c?c.map(function(e){return r.a.createElement("li",{key:e.id,className:"film__genre"},e.name)}):null;return r.a.createElement(n.Fragment,null,r.a.createElement(U,null),r.a.createElement("div",{className:"film container"},r.a.createElement("div",{className:"film__poster"},r.a.createElement("img",{className:"film__img",src:"https://image.tmdb.org/t/p/w300/".concat(t),alt:"".concat(a," poster")})),r.a.createElement("div",{className:"film__info"},r.a.createElement("h1",{className:"film__title"},a),r.a.createElement("h2",{className:"film__subtitle"},i),r.a.createElement("span",{className:"film__rate"},"Rate: ",o),r.a.createElement("span",{className:"film__date"},"Release date: ",l),r.a.createElement("div",{className:"film__genres-block"},r.a.createElement("span",{className:"film__text"},"Genres:"),r.a.createElement("ul",{className:"film__genres"},u)),r.a.createElement("p",{className:"film__description"},s))))}}]),t}(n.Component))),z=(a(55),function(e){function t(){return Object(d.a)(this,t),Object(_.a)(this,Object(b.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"no-results"},r.a.createElement("div",{className:"no-results__cat"},r.a.createElement("span",null,"_/\\*/\\"),r.a.createElement("span",null,"( o_o  )_)"),r.a.createElement("span",null,"( u  u  , ),"),r.a.createElement("span",null,"######")))}}]),t}(n.Component)),G=O(function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(_.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(r)))).state={foundMovies:[],isSpinning:!1,noResults:!1},a.page={query:J.a.parse(a.props.location.search).results,prevQuery:J.a.parse(a.props.location.search).results,pages:1,totalPages:1},a._compareQueries=function(e){var t=J.a.parse(e.location.search).results,n=J.a.parse(a.props.location.search).results;t!==n&&(a.page={query:n,prevQuery:n,pages:1,totalPages:1},a._searchMoviesAsync(n,a.page.pages,!0))},a._setMoviesFetchingState=function(e){a.setState({isSpinning:e})},a._setNoResultsState=function(e){a.setState({noResults:e})},a._initInfiniteScroll=q(function(){window.innerHeight+window.scrollY>=document.body.offsetHeight&&a.page.pages<a.page.totalPages&&(a.page.pages+=1,a._searchMoviesAsync(a.page.query,a.page.pages))}),a._searchMoviesAsync=function(){var e=Object(I.a)(x.a.mark(function e(t,n,r){var i,s,o,c;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a._setMoviesFetchingState(!0),e.next=4,R.searchMovies(t,n);case 4:i=e.sent,s=i.foundMovies,o=i.totalPages,a.page.totalPages!==o&&(a.page.totalPages=o),r?a.setState({foundMovies:s}):a.setState({foundMovies:a.state.foundMovies.concat(s)}),a.state.noResults&&a._setNoResultsState(!1),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(0),c=e.t0.message,a._setNoResultsState(!0),console.log(c);case 17:return e.prev=17,a._setMoviesFetchingState(!1),e.finish(17);case 20:case"end":return e.stop()}},e,this,[[0,12,17,20]])}));return function(t,a,n){return e.apply(this,arguments)}}(),a}return Object(y.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){var e=this.page,t=e.query,a=e.pages;this._searchMoviesAsync(t,a),window.addEventListener("scroll",this._initInfiniteScroll)}},{key:"componentDidUpdate",value:function(e){this._compareQueries(e)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this._initInfiniteScroll)}},{key:"render",value:function(){var e=this.state,t=e.foundMovies,a=e.isSpinning,i=e.noResults,s=this.props.favoriteMoviesIds,o=this.page.query,c=t.map(function(e){return r.a.createElement(T,Object.assign({favoriteMoviesIds:s,key:e.id},e))});return r.a.createElement(n.Fragment,null,r.a.createElement(U,null),r.a.createElement("main",{id:"main",className:"main main_search"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"heading"},r.a.createElement("h1",{className:"heading__title"},0!==t.length?'Results by searching "'.concat(o,'".'):'Results by searching "'.concat(o,'". Try out more...'))),r.a.createElement(Q,null),r.a.createElement("div",{id:"movies-list",className:"movie-list"},i?r.a.createElement(z,null):c),r.a.createElement(H,{isSpinning:a}))))}}]),t}(n.Component)),$=O(function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(_.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(r)))).state={favoriteMovies:[],isSpinning:!1},a._setMoviesFetchingState=function(e){a.setState({isSpinning:e})},a._fetchFavoriteMoviesAsync=Object(I.a)(x.a.mark(function e(){var t,n,r;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a._setMoviesFetchingState(!0),t=a.props.favoriteMoviesIds,e.next=5,R.fetchFavoriteMovies(t);case 5:n=e.sent,a.setState({favoriteMovies:n}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),r=e.t0.message,console.log(r);case 13:return e.prev=13,a._setMoviesFetchingState(!1),e.finish(13);case 16:case"end":return e.stop()}},e,this,[[0,9,13,16]])})),a}return Object(y.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){this._fetchFavoriteMoviesAsync()}},{key:"render",value:function(){var e=this,t=this.state,a=t.favoriteMovies,i=t.isSpinning,s=this.props.favoriteMoviesIds,o=a.map(function(t){return r.a.createElement(T,Object.assign({favoriteMoviesIds:s,fetchFavoriteMoviesAsync:e._fetchFavoriteMoviesAsync,key:t.id},t))});return r.a.createElement(n.Fragment,null,r.a.createElement(U,null),r.a.createElement("main",{id:"main",className:"main main_favorites"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{id:"movies-list",className:"movie-list"},r.a.createElement(H,{isSpinning:i}),o))))}}]),t}(n.Component)),V=function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(_.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(r)))).state={favoriteMoviesIds:localStorage.getItem("favMovies")?localStorage.getItem("favMovies").split(","):[]},a}return Object(y.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this.state.favoriteMoviesIds;return r.a.createElement(M,{value:{favoriteMoviesIds:e}},r.a.createElement(E.a,null,r.a.createElement(w.a,{exact:!0,component:K,path:S.main}),r.a.createElement(w.a,{exact:!0,component:$,path:S.favorites}),r.a.createElement(w.a,{exact:!0,component:G,path:S.search}),r.a.createElement(w.a,{exact:!0,component:Y,path:S.movie})))}}]),t}(n.Component);s.a.render(r.a.createElement(o.a,{history:h},r.a.createElement(V,null)),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/mymovies",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/mymovies","/service-worker.js");c?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):l(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):l(e)})}}()}},[[22,2,1]]]);
//# sourceMappingURL=main.ac3413bd.chunk.js.map